<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>è¨ªå•ã‚±ã‚¢ãƒ»ã‚¯ã‚¨ã‚¹ãƒˆï½œã“ã¨ã¯ã•ã‚“ï¼ˆæ–°äººã‚µè²¬ï¼‰ç·¨ã€ã¾ã»ã‚ã°è¡¨æƒ…å¯¾å¿œã€‘</title>
<style>
  :root{--bg:#f6f7fb;--card:#ffffff;--ink:#0f172a;--muted:#64748b;--accent:#2563eb;--good:#16a34a;--bad:#dc2626;}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic",Arial,"Apple Color Emoji","Segoe UI Emoji","Noto Color Emoji",sans-serif}
  .wrap{max-width:980px;margin:0 auto;padding:18px}
  h1{margin:8px 0 0 0;font-size:22px}
  .sub{color:var(--muted);margin:4px 0 16px 0}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
  .card{background:var(--card);border-radius:14px;box-shadow:0 10px 24px rgba(0,0,0,.08);padding:14px;cursor:pointer;display:flex;flex-direction:column;gap:8px;border:1px solid #e5e7eb}
  .card:hover{transform:translateY(-1px);box-shadow:0 12px 26px rgba(0,0,0,.12)}
  .tag{display:inline-block;background:#eff6ff;color:#1d4ed8;border:1px solid #bfdbfe;border-radius:999px;padding:2px 8px;font-size:12px;margin-right:4px}
  .play{margin-top:auto;align-self:flex-end;background:#111827;color:#fff;border:0;border-radius:10px;padding:8px 12px;font-weight:700}
  .stage{background:var(--card);border-radius:16px;box-shadow:0 10px 28px rgba(0,0,0,.10);overflow:hidden;display:none;margin-top:6px}
  .scene{padding:14px;border-bottom:1px solid #eee}
  .row{display:flex;gap:10px;align-items:flex-start}
  .char{flex:1;background:#f3f4f6;border-radius:12px;padding:10px}
  .char h3{margin:0 0 6px 0;font-size:15px}
  .char .face{font-size:26px;line-height:1.2}
  .bubble{background:#eef2ff;border-left:4px solid var(--accent);padding:10px;border-radius:8px}
  .bubble p{margin:0;font-size:15px}
  .system{padding:10px 14px;background:#ecfeff;border-left:4px solid #06b6d4}
  .choices{display:grid;grid-template-columns:1fr;gap:8px;padding:12px}
  .choices button{appearance:none;border:0;border-radius:10px;padding:11px 12px;font-size:15px;font-weight:700;background:#111827;color:#fff;cursor:pointer}
  .choices button.secondary{background:#334155}
  .choices button.warn{background:#b91c1c}
  .choices button:hover{filter:brightness(1.05)}
  .result{padding:12px;display:none}
  .result.good{background:#ecfdf5;border-left:4px solid var(--good)}
  .result.bad{background:#fef2f2;border-left:4px solid var(--bad)}
  .footer{display:flex;gap:8px;justify-content:flex-end;padding:12px;border-top:1px solid #eee}
  .footer button{appearance:none;border:0;background:#2563eb;color:#fff;padding:10px 12px;border-radius:10px;font-weight:700}
  .footer button.alt{background:#475569}
  .meter{margin-top:8px;height:10px;background:#e5e7eb;border-radius:999px;overflow:hidden}
  .meter>div{height:100%;width:0%;background:linear-gradient(90deg,#22c55e,#16a34a);transition:width .5s}
  .badge{display:inline-block;background:#111827;color:#fff;border-radius:999px;padding:4px 10px;font-size:12px;margin-left:8px}
  .topbar{display:flex;gap:10px;align-items:center;justify-content:space-between}
  .back{appearance:none;border:0;background:#111827;color:#fff;border-radius:10px;padding:8px 12px;font-weight:700}
  .muted{color:var(--muted);font-size:13px}
</style>
</head>
<body>
<div class="wrap">
  <div class="topbar">
    <div>
      <h1>è¨ªå•ã‚±ã‚¢ãƒ»ã‚¯ã‚¨ã‚¹ãƒˆï½œã“ã¨ã¯ã•ã‚“ï¼ˆæ–°äººã‚µè²¬ï¼‰ç·¨</h1>
      <p class="sub">ä¸»äººå…¬ï¼š<strong>ã“ã¨ã¯ã•ã‚“ï¼ˆæ–°äººã‚µãƒ¼ãƒ“ã‚¹æä¾›è²¬ä»»è€…ï¼‰</strong>ï½œã‚»ãƒ¼ãƒ–ä¸è¦ãƒ»ã‚¹ãƒãƒ›OKï½œç¾å ´Ã—ç®¡ç†ã®åˆ¤æ–­åŠ›ã‚’é›ãˆã‚‹</p>
    </div>
    <button class="back" id="toMenu" style="display:none" onclick="toMenu()">ç« ä¸€è¦§ã¸</button>
  </div>

  <div id="menu"><div class="grid" id="cards"></div></div>

  <div class="stage" id="game">
    <div class="scene">
      <div class="row">
        <div class="char"><h3>ã“ã¨ã¯ã•ã‚“ï¼ˆæ–°äººã‚µè²¬ï¼‰</h3><div class="face" id="kFace">ğŸ™‚</div><div class="muted">â€»ç·Šå¼µã—ã¤ã¤ã‚‚å‰å‘ã</div></div>
        <div class="char"><h3>ã¾ã»ã‚ã°ã•ã‚“ï¼ˆãƒ™ãƒ†ãƒ©ãƒ³ãƒ˜ãƒ«ãƒ‘ãƒ¼ï¼‰</h3><div class="face" id="mFace">ğŸ§“</div><div class="muted">â€»åå¿œãŒå¤‰ã‚ã‚Šã¾ã™</div></div>
        <div class="char"><h3>å¥ˆè‰¯ç”·ãã‚“ï¼ˆå®¶æ—ãƒ»ã‚­ãƒ¼ãƒ‘ãƒ¼ã‚½ãƒ³ï¼‰</h3><div class="face" id="oFace">ğŸ•´ï¸</div><div class="muted">â€»å ´é¢ã«ã‚ˆã‚Šç™»å ´</div></div>
      </div>
    </div>

    <div class="system"><span id="chapterTitle"></span> <span class="badge" id="badge">è¨­å•1/2</span></div>
    <div class="scene"><div class="bubble" id="dialogue"></div></div>
    <div class="choices" id="choices"></div>
    <div class="result" id="resultBox"></div>

    <div class="scene" id="summaryBox" style="display:none">
      <h3>ç« ã®ã¾ã¨ã‚</h3>
      <p id="summaryText"></p>
      <div class="meter"><div id="meterBar"></div></div>
    </div>

    <div class="footer">
      <button class="alt" onclick="restart()">ã“ã®ç« ã‚’ã‚„ã‚Šç›´ã™</button>
      <button id="nextBtn" onclick="next()">æ¬¡ã¸</button>
    </div>
  </div>
</div>

<script>
const chapters = [
  { id:'S1', title:'ç¬¬1ç« ï¼šåˆã‚ã¦ã®è¨ªå•ä»‹è­·è¨ˆç”»æ›¸', q:[
    { text:'æ–°è¦åˆ©ç”¨è€…ãƒ»å‰ç”°ã•ã‚“ã€‚åˆå›ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆå¾Œã€ã“ã¨ã¯ã•ã‚“ã¯è¨ˆç”»æ›¸ä½œæˆã¸ã€‚æœ€åˆã®ä¸€æ­©ã¯ï¼Ÿ',
      opts:[ ['æœ¬äººã®ç›®æ¨™ã‚’èãå–ã‚Šã€ãƒ‹ãƒ¼ã‚ºã‚’æ•´ç†',+15,'good','æœ¬äººä¸»ä½“ã®ç›®æ¨™è¨­å®šãŒæ ¸ã€‚'],
             ['éå»ã®æ§˜å¼ã‚’ã‚³ãƒ”ãƒš',-10,'bad','å€‹åˆ¥æ€§ãŒæ¬ è½ã€‚'],
             ['ãƒ˜ãƒ«ãƒ‘ãƒ¼ã®å¸Œæœ›ã‚’æœ€å„ªå…ˆ',-5,'neutral','ãƒãƒ¼ãƒ éƒ½åˆåé‡ã¯NGã€‚'] ]},
    { text:'è¨ˆç”»æ›¸ã®èª¬æ˜ã€‚ã©ã®é †ç•ªãŒè‰¯ã„ï¼Ÿ',
      opts:[ ['ç›®çš„â†’å†…å®¹â†’é »åº¦â†’åŒæ„â†’è¦‹ç›´ã—æ™‚æœŸ',+15,'good','ç†è§£ã¨åˆæ„å½¢æˆãŒé€²ã‚€ã€‚'],
             ['å°‚é–€ç”¨èªã§ä¸€æ°—ã«èª¬æ˜',-10,'bad','ä¼ã‚ã‚‰ãªã„ã€‚'],
             ['ç½²åã ã‘ãŠé¡˜ã„',-20,'bad','ä¸é©åˆ‡ã€‚'] ]}
  ]},
  { id:'S2', title:'ç¬¬2ç« ï¼šæ‹…å½“è€…ä¼šè­°ã®æº–å‚™', q:[
    { text:'ä¼šè­°å‰ã«æƒãˆã‚‹ã¹ãæƒ…å ±ã¯ï¼Ÿ',
      opts:[ ['ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆè¦ç‚¹ãƒ»ç›®æ¨™ãƒ»èª²é¡Œãƒ»å½¹å‰²åˆ†æ‹…æ¡ˆ',+15,'good','è­°è«–ãŒæ•´ç†ã•ã‚Œã‚‹ã€‚'],
             ['é›‘è«‡ãƒ¡ãƒ¢',-5,'neutral','ç›®çš„ã‹ã‚‰ã‚ºãƒ¬ã‚‹ã€‚'],
             ['è³‡æ–™ã¯å½“æ—¥é›†ã‚ã‚‹',-15,'bad','éåŠ¹ç‡ã€‚'] ]},
    { text:'å½“æ—¥ã®é€²è¡Œã§å¤§åˆ‡ãªã®ã¯ï¼Ÿ',
      opts:[ ['æ™‚é–“é…åˆ†ã¨ç™ºè¨€ã®å¯è¦–åŒ–ï¼ˆè­°äº‹ï¼‰',+15,'good','åˆæ„å½¢æˆã®åœŸå°ã€‚'],
             ['å£°ã®å¤§ãã„äººã‚’å„ªå…ˆ',-10,'bad','åã‚‹ã€‚'],
             ['æ²ˆé»™ã‚’æ”¾ç½®',-10,'bad','æ„è¦‹ãŒå‡ºãªã„ã€‚'] ]}
  ]},
  { id:'S3', title:'ç¬¬3ç« ï¼šåˆå‹•ã‚¯ãƒ¬ãƒ¼ãƒ å¯¾å¿œ', q:[
    { text:'åˆ©ç”¨è€…ã‹ã‚‰ã€Œæƒé™¤ãŒé›‘ã€ã¨é›»è©±ã€‚åˆå‹•ã¯ï¼Ÿ',
      opts:[ ['å‚¾è´â†’å…·ä½“ç¢ºèªâ†’ä¸€æ¬¡è¬ç½ªâ†’æ˜¯æ­£æ¡ˆ',+20,'good','åŸºæœ¬ã®å‹ã€‚'],
             ['ã™ãè¨€ã„è¨³',-15,'bad','ç«ã«æ²¹ã€‚'],
             ['æ‹…å½“è€…ã‚’è²¬ã‚ã‚‹',-10,'bad','ãƒãƒ¼ãƒ å´©å£Šã€‚'] ]},
    { text:'äº‹å®Ÿç¢ºèªå¾Œã®å†…éƒ¨å¯¾å¿œã¯ï¼Ÿ',
      opts:[ ['é¢è«‡â†’æŒ‡å°â†’å…±æœ‰',+15,'good','å†ç™ºé˜²æ­¢ã€‚'],
             ['çŠ¯äººæ¢ã—ã®ã¿',-10,'bad','èç¸®ã€‚'],
             ['æ”¾ç½®',-20,'bad','ä¿¡é ¼ä½ä¸‹ã€‚'] ]}
  ]},
  { id:'S4', title:'ç¬¬4ç« ï¼šãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°è¨ªå•', q:[
    { text:'è¨ªå•æ™‚ã€è¦³å¯Ÿãƒ»è³ªå•ã®è»¸ã¯ï¼Ÿ',
      opts:[ ['ADL/IADLãƒ»ç–¼ç—›ãƒ»é£Ÿäº‹ãƒ»ç¡çœ ãƒ»æ°—åˆ†',+15,'good','å¤‰åŒ–ã«æ°—ã¥ã‘ã‚‹ã€‚'],
             ['é›‘è«‡ä¸­å¿ƒ',-5,'neutral','å’Œã‚€ãŒæƒ…å ±ä¸è¶³ã€‚'],
             ['è¨˜éŒ²ã¯å¾Œã§æƒ³åƒ',-20,'bad','èª¤è¨˜ã®å…ƒã€‚'] ]},
    { text:'å°ã•ãªå¤‰åŒ–ã‚’ç™ºè¦‹ã€‚å¯¾å¿œã¯ï¼Ÿ',
      opts:[ ['è¨˜éŒ²â†’å…±æœ‰â†’å¿…è¦ãªã‚‰è¦‹ç›´ã—',+15,'good','PDCAã‚’å›ã™ã€‚'],
             ['æ¬¡å›ã«å›ã™',-10,'bad','é…ã‚Œã‚‹ã€‚'],
             ['æ§˜å­è¦‹ã§æ”¾ç½®',-15,'bad','å–ã‚Šé€ƒã—ã€‚'] ]}
  ]},
  { id:'S5', title:'ç¬¬5ç« ï¼šè¨˜éŒ²ç‚¹æ¤œã¨ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯', q:[
    { text:'è¨˜éŒ²ç‚¹æ¤œã§èª¤è¨˜ç™ºè¦‹ã€‚æŒ‡å°ã®ã‚³ãƒ„ã¯ï¼Ÿ',
      opts:[ ['äº‹å®Ÿãƒ™ãƒ¼ã‚¹ã§æ˜¯æ­£ï¼‹è‰¯ã„ç‚¹ã‚‚ä¼ãˆã‚‹',+15,'good','å­¦ã³ã‚’ä¿ƒã™ã€‚'],
             ['äººæ ¼ã‚’å¦å®š',-15,'bad','é–¢ä¿‚æ‚ªåŒ–ã€‚'],
             ['å…¨éƒ¨è‡ªåˆ†ã§æ›¸ãç›´ã™',-10,'bad','è‚²ãŸãªã„ã€‚'] ]},
    { text:'å…±æœ‰ã®ç¯„å›²ã¯ï¼Ÿ',
      opts:[ ['å¿…è¦æœ€å°é™ãƒ»å®ˆç§˜ã‚’å¾¹åº•',+10,'good','ä¿¡é ¼ã®æ ¹å¹¹ã€‚'],
             ['ã‚°ãƒ«ãƒ¼ãƒ—LINEã«è©³ç´°æ™’ã—',-20,'bad','æƒ…å ±æ¼ãˆã„ã€‚'],
             ['å£é ­ã§å™‚è©±',-10,'bad','æ··ä¹±ã€‚'] ]}
  ]},
  { id:'S6', title:'ç¬¬6ç« ï¼šã‚·ãƒ•ãƒˆèª¿æ•´ã¨æ¬ å“¡å¯¾å¿œ', q:[
    { text:'æ€¥ãªæ¬ å“¡ã€‚æœ€åˆã®åˆ¤æ–­ã¯ï¼Ÿ',
      opts:[ ['å„ªå…ˆåº¦â†’ä»£æ›¿æ¡ˆâ†’é€£çµ¡',+15,'good','æ··ä¹±ã‚’æœ€å°åŒ–ã€‚'],
             ['æ–°äººã‚’ç„¡ç†ã«æŠ•å…¥',-10,'bad','äº‹æ•…ã®å…ƒã€‚'],
             ['æ”¾ç½®',-20,'bad','ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢ã€‚'] ]},
    { text:'é€£ç¶šæ®‹æ¥­ã®è¦è«‹ã€‚é…æ…®ã¯ï¼Ÿ',
      opts:[ ['åŠ´å‹™ç®¡ç†ã¨å¥åº·é…æ…®ã€åˆ†æ•£é…ç½®',+15,'good','æŒç¶šå¯èƒ½æ€§ã€‚'],
             ['ç„¡åˆ¶é™ã«ãŠé¡˜ã„',-15,'bad','é›¢è·ãƒªã‚¹ã‚¯ã€‚'],
             ['å½“æ—¥ä¸­ã«ãŠé¡˜ã„ã ã‘',-10,'bad','æº–å‚™ä¸è¶³ã€‚'] ]}
  ]},
  { id:'S7', title:'ç¬¬7ç« ï¼šä»‹è­·ä¿é™ºå¤–ä¾é ¼ã®ç·šå¼•ã', q:[
    { text:'å®¶æ—ã‹ã‚‰ã€Œé€šå¸³ç®¡ç†ã‚‚ãŠé¡˜ã„ã€ã€‚å¯¾å¿œã¯ï¼Ÿ',
      opts:[ ['åˆ¶åº¦ä¸Šä¸å¯ã‚’èª¬æ˜ï¼‹ä»£æ›¿æ¡ˆ',+20,'good','ç·šå¼•ãã¨ä»£æ¡ˆã€‚'],
             ['å°‘é¡ã ã‹ã‚‰OK',-20,'bad','ã‚³ãƒ³ãƒ—ãƒ©é•åã€‚'],
             ['æ›–æ˜§ã«ç¬‘ã£ã¦æµã™',-10,'bad','ç«ç¨®ã«ã€‚'] ]},
    { text:'è‰ã‚€ã—ã‚Šãƒ»æ´—è»Šã‚’æ±‚ã‚ã‚‰ã‚ŒãŸã‚‰ï¼Ÿ',
      opts:[ ['ä¿é™ºå¤–â†’è‡ªè²»ã‚µãƒ¼ãƒ“ã‚¹æ¡ˆå†…',+15,'good','èª¤è§£é˜²æ­¢ã€‚'],
             ['ãã®å ´ã§å¯¾å¿œ',-15,'bad','ä¸æ­£è«‹æ±‚ã€‚'],
             ['æ–­ã‚‹ã ã‘',-5,'neutral','èª¬æ˜ä¸è¶³ã€‚'] ]}
  ]},
  { id:'S8', title:'ç¬¬8ç« ï¼šå¤šè·ç¨®é€£æºï¼ˆã‚±ã‚¢ãƒãƒãƒ»çœ‹è­·ï¼‰', q:[
    { text:'ã©ã®æƒ…å ±ã‚’å…±æœ‰ï¼Ÿ',
      opts:[ ['äº‹å®Ÿãƒ»å¤‰åŒ–ãƒ»ææ¡ˆã‚’ç°¡æ½”ã«',+15,'good','ç›¸æ‰‹ãŒå‹•ã‘ã‚‹æƒ…å ±ã€‚'],
             ['ä¸»è¦³ã¨æ„Ÿæƒ³ä¸­å¿ƒ',-10,'bad','åˆ¤æ–­ä¸èƒ½ã€‚'],
             ['å¤§é‡ã®æœªæ•´ç†æƒ…å ±',-5,'neutral','ä¼ã‚ã‚Šã«ãã„ã€‚'] ]},
    { text:'é€£æºãŒæ»ã‚‹ã¨ãã®å·¥å¤«ã¯ï¼Ÿ',
      opts:[ ['çª“å£ä¸€æœ¬åŒ–ãƒ»ç· åˆ‡ãƒ»ãƒ†ãƒ³ãƒ—ãƒ¬æ´»ç”¨',+15,'good','ä»•çµ„ã¿ã§å›ã™ã€‚'],
             ['é‹ã«ä»»ã›ã‚‹',-10,'bad','å†ç™ºã€‚'],
             ['èª°ã‹ã®ã›ã„ã«ã™ã‚‹',-15,'bad','é–¢ä¿‚æ‚ªåŒ–ã€‚'] ]}
  ]},
  { id:'S9', title:'ç¬¬9ç« ï¼šäº‹æ•…ãƒ»ãƒ’ãƒ¤ãƒªã®åˆå‹•', q:[
    { text:'è»¢å€’ãƒ’ãƒ¤ãƒªã®å ±å‘Šã‚’å—ã‘ãŸã€‚åˆå‹•ã¯ï¼Ÿ',
      opts:[ ['çŠ¶æ…‹ç¢ºèªâ†’åŒ»ç™‚â†’å®¶æ—â†’è¨˜éŒ²â†’æ˜¯æ­£',+20,'good','å‘½ã¨å†ç™ºé˜²æ­¢ã€‚'],
             ['ä¸Šå¸ã«ä¸¸æŠ•ã’',-10,'bad','è²¬ä»»ä¸æ˜ç¢ºã€‚'],
             ['è¨˜éŒ²ã‚’å¾Œå›ã—',-10,'bad','è¨¼è·¡æ¬ è½ã€‚'] ]},
    { text:'ç¤¾å†…å…±æœ‰ã®ãƒã‚¤ãƒ³ãƒˆã¯ï¼Ÿ',
      opts:[ ['åŒ¿ååŒ–ã¨å­¦ã³ã«é›†ä¸­',+15,'good','è²¬ã‚ãªã„æ–‡åŒ–ã€‚'],
             ['å€‹äººåã‚’ã•ã‚‰ã™',-15,'bad','èç¸®ã€‚'],
             ['å…±æœ‰ã—ãªã„',-20,'bad','å†ç™ºã€‚'] ]}
  ]},
  { id:'S10', title:'ç¬¬10ç« ï¼šé¢è«‡ã¨OJTï¼ˆã¾ã»ã‚ã°ã•ã‚“ã¨ï¼‰', q:[
    { text:'æ°—ã«ãªã‚‹æ”¯æ´ãŒã‚ã£ãŸæ–°äººã¸ã€‚é¢è«‡ã®åˆ‡ã‚Šå‡ºã—ã¯ï¼Ÿ',
      opts:[ ['äº‹å®Ÿâ†’å½±éŸ¿â†’æœŸå¾…â†’æ”¯æ´ã®é †ã§',+15,'good','å®‰å¿ƒã—ã¦æ”¹å–„ã¸ã€‚'],
             ['æ„Ÿæƒ…çš„ã«å±è²¬',-15,'bad','èç¸®ã€‚'],
             ['æ”¾ç½®',-10,'bad','æ”¹å–„ã›ãšã€‚'] ]},
    { text:'OJTã®è¨­è¨ˆã¯ï¼Ÿ',
      opts:[ ['ç›®æ¨™ãƒ»è¦³å¯Ÿé …ç›®ãƒ»æŒ¯ã‚Šè¿”ã‚Šæ™‚é–“ã‚’è¨­å®š',+15,'good','å­¦ã³ãŒå®šç€ã€‚'],
             ['ç¾å ´ä»»ã›',-10,'bad','å±äººåŒ–ã€‚'],
             ['ãƒã‚§ãƒƒã‚¯ã ã‘å³ã—ã',-5,'neutral','æ€–ã•ã ã‘æ®‹ã‚‹ã€‚'] ]}
  ]},
];

// ====== çŠ¶æ…‹ ======
let trust = 0, qIndex = 0, currentChapter = null;

// ====== è¦ç´  ======
const menu = document.getElementById('menu');
const cards = document.getElementById('cards');
const game = document.getElementById('game');
const badge = document.getElementById('badge');
const chapTitle = document.getElementById('chapterTitle');
const dialogue = document.getElementById('dialogue');
const choices = document.getElementById('choices');
const resultBox = document.getElementById('resultBox');
const kFace = document.getElementById('kFace');
const mFace = document.getElementById('mFace');
const oFace = document.getElementById('oFace');
const nextBtn = document.getElementById('nextBtn');
const toMenuBtn = document.getElementById('toMenu');
const summaryBox = document.getElementById('summaryBox');
const summaryText = document.getElementById('summaryText');
const meterBar = document.getElementById('meterBar');

// ====== ãƒ¡ãƒ‹ãƒ¥ãƒ¼ ======
function buildMenu(){
  cards.innerHTML = '';
  chapters.forEach((ch)=>{
    const c = document.createElement('div');
    c.className = 'card';
    const tags = document.createElement('div');
    const t2 = document.createElement('span'); t2.className='tag'; t2.textContent = 'æ–°äººã‚µè²¬';
    tags.appendChild(t2);
    const h = document.createElement('div'); h.innerHTML = `<strong>${ch.title}</strong>`;
    const s = document.createElement('div'); s.className='muted'; s.textContent = `è¨­å• ${ch.q.length} å•ï¼ã‚¯ãƒªãƒƒã‚¯ã§é–‹å§‹`;
    const b = document.createElement('button'); b.className='play'; b.textContent='ã“ã®ç« ã§éŠã¶'; b.onclick = ()=>startChapter(ch);
    c.appendChild(tags); c.appendChild(h); c.appendChild(s); c.appendChild(b);
    cards.appendChild(c);
  });
}
buildMenu();

// ====== ç« é–‹å§‹ ======
function startChapter(ch){
  currentChapter = ch;
  trust = 0; qIndex = 0;
  kFace.textContent = 'ğŸ™‚'; mFace.textContent='ğŸ§“'; oFace.textContent='ğŸ•´ï¸';
  chapTitle.textContent = ch.title;
  menu.style.display='none'; game.style.display='block'; toMenuBtn.style.display='inline-block';
  summaryBox.style.display='none'; resultBox.style.display='none'; nextBtn.style.display='none';
  renderQuestion();
}

// ====== è¨­å•æç”» ======
function renderQuestion(){
  const q = currentChapter.q[qIndex];
  badge.textContent = `è¨­å•${qIndex+1}/${currentChapter.q.length}`;
  dialogue.innerHTML = q.text;
  choices.innerHTML = '';
  resultBox.style.display='none';
  q.opts.forEach((op,i)=>{
    const b = document.createElement('button');
    b.textContent = (i===0?'1ï¸âƒ£ ':'')+(i===1?'2ï¸âƒ£ ':'')+(i===2?'3ï¸âƒ£ ':'') + op[0];
    if(i===1) b.classList.add('secondary');
    if(i===2) b.classList.add('warn');
    b.onclick = ()=>{
      trust += op[1];
      const kind = op[2], msg=op[3];
      // é¡”ã®å¤‰åŒ–ï¼šã¾ã»ã‚ã°ã•ã‚“ â†’ good: ğŸ˜Š / neutral: ğŸ˜± / bad: ğŸ˜ 
      if(kind==='good'){ mFace.textContent='ğŸ˜Š'; resultBox.className='result good'; oFace.textContent='ğŸ•´ï¸'; }
      else if(kind==='bad'){ mFace.textContent='ğŸ˜ '; resultBox.className='result bad'; oFace.textContent='ğŸ˜¡'; }
      else { mFace.textContent='ğŸ˜±'; resultBox.className='result'; oFace.textContent='ğŸ•´ï¸'; }
      resultBox.innerHTML = `<strong>çµæœï¼š</strong>${msg}ï¼ˆä¿¡é ¼ ${trust>=0?'+':''}${op[1]}ï¼‰`;
      resultBox.style.display='block';
      Array.from(choices.querySelectorAll('button')).forEach(x=>x.disabled=true);
      nextBtn.style.display='inline-block';
    };
    choices.appendChild(b);
  });
}

// ====== æ¬¡ã¸ï¼çµ‚äº† ======
function next(){
  qIndex++;
  if(qIndex >= currentChapter.q.length){ finishChapter(); }
  else { resultBox.style.display='none'; nextBtn.style.display='none'; renderQuestion(); }
}

function finishChapter(){
  const max = currentChapter.q.length*20;
  const pct = Math.max(0, Math.min(100, (trust/max)*100));
  const grade = pct>=80?'Sï¼ˆã¨ã¦ã‚‚è‰¯ã„ï¼‰':pct>=60?'Aï¼ˆè‰¯ã„ï¼‰':pct>=40?'Bï¼ˆãµã¤ã†ï¼‰':'Cï¼ˆè¦‹ç›´ã—ï¼‰';
  summaryText.innerHTML = `æœ€çµ‚è©•ä¾¡ï¼š<strong>${grade}</strong><br/>ç²å¾—ã‚¹ã‚³ã‚¢ï¼šä¿¡é ¼ ${trust} / ${max}<br/>å­¦ã³ï¼š<ul><li>æœ¬äººãƒ»å®¶æ—ãƒ»ç¾å ´ã®åˆæ„å½¢æˆ</li><li>äº‹å®Ÿãƒ™ãƒ¼ã‚¹ã®è¨˜éŒ²ã¨é€£æº</li><li>åˆ¶åº¦ã®ç·šå¼•ãã¨ä»£æ›¿ææ¡ˆ</li></ul>`;
  meterBar.style.width = pct + '%';
  summaryBox.style.display='block';
  nextBtn.style.display='none';
  choices.innerHTML='';
}

function restart(){
  trust = 0; qIndex = 0;
  kFace.textContent = 'ğŸ™‚'; mFace.textContent='ğŸ§“'; oFace.textContent='ğŸ•´ï¸';
  summaryBox.style.display='none'; resultBox.style.display='none'; nextBtn.style.display='none';
  renderQuestion();
}

function toMenu(){
  game.style.display='none'; menu.style.display='block'; toMenuBtn.style.display='none';
}
</script>
</body>
</html>
